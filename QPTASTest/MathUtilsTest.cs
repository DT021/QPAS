// -----------------------------------------------------------------------
// <copyright file="MathUtilsTest.cs" company="">
// Copyright 2014 Alexander Soffronow Pagonidis
// </copyright>
// -----------------------------------------------------------------------

using System;
using System.Collections.Generic;
using NUnit.Framework;
using QPAS;

namespace QPASTest
{
    [TestFixture]
    public class MathUtilsTest
    {
        [Test]
        public void AutoCorrReturnsCorrectValues()
        {
            var inputs = new List<double>
            {
                0.5376671395461,
                1.29621787504899,
                -3.55506473605263,
                4.95490519596686,
                -2.80225494151279,
                -0.764280215796134,
                1.19286151385857,
                -0.53147180746094,
                2.80218045088143,
                -0.466335443302234,
                -0.540927030315638,
                7.15424743637325,
                -3.65940618154227,
                2.24646436819609,
                1.50320200196186,
                -0.982763835315527,
                0.795564613909559,
                1.408875897702,
                -0.204807466201298,
                1.4978555314146,
                0.663339209978946,
                -0.461791642863504,
                2.59622270762196,
                -0.294490284849147,
                -0.424102867524101,
                2.1760345287708,
                0.181085893777167,
                0.00436695174860635,
                1.32419752526591,
                -1.38459519564131,
                1.96954990261294,
                -2.82274854248543,
                0.96659528055876,
                -0.887698343225994,
                -3.20365592573805,
                3.57316576038512,
                -4.0574739153538,
                0.358261434189197,
                2.45041739872113,
                -3.83674327811863,
                2.97957251286344,
                -1.85072101437557,
                0.458411334687369,
                -0.247795184135431,
                -0.858531774796383,
                1.14768721776562,
                -0.999707640337226,
                0.762535010541496,
                0.300679362301719,
                0.64371491610364,
            };

            var targets = new List<double> //from matlab
            {
                1,
                -0.6108277,
                0.168786609,
                0.353260597,
                -0.439964685,
                0.418941056,
                -0.188144039,
                -0.07158148,
                0.318816635,
                -0.329525374
            };

            var res = MathUtils.AutoCorr(inputs, 10);
            for (int i = 0; i < targets.Count; i++)
            {
                Assert.IsTrue(ApproximatelyEqual(res[i], targets[i], 0.05), i.ToString());
            }
        }

        private bool ApproximatelyEqual(double a, double b, double slack = 0.01)
        {
            return Math.Abs(a) - Math.Abs(b) < slack;
        }
    }
}
